---
# Backend Role - Deploy healthcare services to Kubernetes
# Uses relative paths when running from infrastructure/ansible directory

- name: Create healthcare namespace
  command: kubectl apply -f ../../kubernetes/namespace.yaml

- name: Apply ConfigMaps
  command: kubectl apply -f ../../kubernetes/configmaps/

- name: Apply Secrets
  command: kubectl apply -f ../../kubernetes/secrets/
  ignore_errors: yes

- name: Deploy backend services
  command: kubectl apply -f ../../kubernetes/deployments/

- name: Apply Ingress
  command: kubectl apply -f ../../kubernetes/ingress/
  ignore_errors: yes

- name: Apply HPA
  command: kubectl apply -f ../../kubernetes/hpa/
  ignore_errors: yes

- name: Wait for deployments to be ready
  command: kubectl rollout status deployment/{{ item }} -n healthcare --timeout=240s
  loop:
    - vitals-generator
    - alert-engine
    - summarizer-service
    - frontend
